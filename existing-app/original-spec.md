# SheetsリストからGカレンダーへの転記アプリ 仕様書 Ver02

D241222 Sun W241216 Ver01 作成  
D250108 Wed W250106 Ver02 作成

## 目的

* Google スプレッドシートのリストから Google カレンダーにタスクを転記し、Google Docs ファイルも同時に作成して管理する。

## 使用する Google サービス

1. **Google スプレッドシート**
2. **Google カレンダー**
3. **Google ドライブ / Google ドキュメント (Docs)**

## 使用スプレッドシート

* スプレッドシート名: `カレンダータスク管理アプリ`
* シート名: `リストからタスク`
* 別シート: `TaskNO` (タスク番号を管理)
* データ開始行: 4行目（1～3行目は見出し）

## 転記先 Google カレンダー

* カレンダー名: `タスク・フォロー`
* カレンダーID: `9dsoil5r12um5nojs5qp1hun0g@group.calendar.google.com`

## タスク転記ルール

### シート列対応

* **A列**: タスク (taskColumn)
* **B列**: 期限 (dueDate)
* **C列**: タスク詳細 (taskDetail)
* **D列**: 関連タスク (relatedTask)

### 期限日の扱い

1. 期限が空欄 または 期限 <= 本日
   * 本日の1日だけを終日イベントとして登録する
   * 開始日 = 本日 0:00
   * 終了日 = 翌日 0:00 (排他エンド)

2. 期限が未来日付の場合
   * 「(期限日 - 4日) と 本日」のどちらが遅いかを開始日にする
   * 終日は「期限日当日の翌日 0:00」(排他エンド)
   * 例：期限が 1/10 で本日が 1/05 → 開始日は 1/06 (1/10 -4日 = 1/06) と 1/05 のどちらが遅いか → 1/06

### イベントタイトル

* `Tsk-xxxx タスク名`
* 4桁ゼロ埋めのタスク番号 (`0001`, `0025` など)
* 末尾に `[[Tsk]] [[TaskList]]` は付与しない

### 複数行の関連タスクや親タスクの出力

1. **関連タスク**
   * D列が数値の場合のみ、`関連タスク： Tsk-xxxx` を1行出力（xxxx は4桁ゼロ埋め）
   * D列が空欄の場合は何も表示しない

2. **親子タスク**
   * A列の先頭に `>` または `＞` があれば「子タスク」とみなす
   * 子タスク名 = ( `>` / `＞` を除去後の文字列 )
   * 親タスク名 = 前行までに取得した、先頭に `>` / `＞` がついていないタスク名
   * イベントタイトルでは `子タスク名@親タスク名` として表示
   * 説明欄 (Description) にも `親タスク： (親タスク名)` を追加
   * 親タスク ( `>` / `＞` なし ) を見つけたら、それを `currentParentTaskName` として更新

### 終日イベント

* Google カレンダーの `createAllDayEvent` を用いて、終日の予定として登録する
* 終了日時は排他エンドとなるため、実際には「終了日の 0:00」を設定する

### タスク番号 (TaskNO) 管理

* シート `TaskNO` のセル `A1` に現在のタスク番号が入っている
* イベントを1件作成するごとにタスク番号を +1 して、シート側に書き戻す
* イベントタイトルに使う際は **4桁ゼロ埋め** (`0012`, `0123` など)

### イベントの Description

* **関連タスク**（D列が数値）: `関連タスク： Tsk-xxxx` を出力（xxxx は4桁ゼロ埋め）
* **子タスク**: `親タスク： 親タスク名` を1行追加
* **タスク詳細**: C列の文字列（HTML可）を出力
* 文字数は **3,500字** を上限とし、超過分は切り捨てる

### Docs ファイル連携

1. イベント作成と同時に、タイトルと同名の **Google Docs** を新規作成
2. 作成した Docs ファイルの URL を、イベントの **「場所」欄** に設定
3. Docs ファイルは Google ドライブ上の `"Tsk タスク管理"` フォルダに配置
   * 当該フォルダが存在しなければ、自動で新規作成
4. カレンダーイベントの **Description** をその Docs に書き込んで、同期させる

### 処理完了メッセージ

* 処理開始時間 (`startTime`) と処理終了時間 (`endTime`) を比較して、所要秒数を計測
* メッセージの例: `処理が完了しました。3.45秒でした。`
* `SpreadsheetApp.getUi().showModalDialog()` で 2秒後に自動閉じるダイアログを表示
