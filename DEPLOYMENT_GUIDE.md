# デプロイメントガイド

このガイドでは、タスク管理WebアプリケーションをGoogle Apps Script (GAS)でデプロイする手順を説明します。

## 前提条件

- Googleアカウント
- Google Apps Scriptへのアクセス権限
- 以下のファイルが準備されていること：
  - `Code.gs` - バックエンドロジック
  - `index.html` - フロントエンドUI

## デプロイ手順

### ステップ1: GASプロジェクトの作成

1. [Google Apps Script](https://script.google.com/)にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「タスク管理Webアプリ」に変更（左上の「無題のプロジェクト」をクリック）

### ステップ2: ファイルのアップロード

#### Code.gsの配置
1. デフォルトの`Code.gs`ファイルが開いている状態で、既存のコードを削除
2. このリポジトリの`Code.gs`の内容をすべてコピー＆ペースト
3. `Ctrl+S`（または`Cmd+S`）で保存

#### index.htmlの追加
1. 左側のファイルリストで「+」ボタンをクリック
2. 「HTML」を選択
3. ファイル名を`index`と入力（拡張子`.html`は自動的に追加されます）
4. このリポジトリの`index.html`の内容をすべてコピー＆ペースト
5. `Ctrl+S`（または`Cmd+S`）で保存

### ステップ3: Webアプリとしてデプロイ

1. 右上の「デプロイ」ボタンをクリック
2. 「新しいデプロイ」を選択
3. 「種類の選択」で⚙️アイコンをクリックし、「ウェブアプリ」を選択
4. 以下の設定を行う：
   - **説明**: 「初回デプロイ」（任意）
   - **次のユーザーとして実行**: 「自分」を選択
   - **アクセスできるユーザー**: 以下のいずれかを選択
     - 「自分のみ」- 自分だけがアクセス可能
     - 「全員」- 誰でもアクセス可能（推奨しません）
     - 組織内のユーザーのみ（Google Workspaceの場合）
5. 「デプロイ」ボタンをクリック

### ステップ4: 権限の承認

初回デプロイ時に権限の承認が必要です：

1. 「アクセスを承認」ボタンをクリック
2. Googleアカウントを選択
3. 「このアプリは確認されていません」という警告が表示される場合：
   - 「詳細」をクリック
   - 「タスク管理Webアプリ（安全ではないページ）に移動」をクリック
4. 以下の権限を承認：
   - ✅ **Google Calendar API** - カレンダーイベントの作成
   - ✅ **Google Drive API** - フォルダとファイルの管理
   - ✅ **Google Docs API** - ドキュメントの作成と編集
5. 「許可」ボタンをクリック

### ステップ5: デプロイURLの取得

1. 権限承認後、デプロイ完了画面が表示されます
2. **ウェブアプリのURL**をコピー
   - 形式: `https://script.google.com/macros/s/[デプロイID]/exec`
3. このURLをブックマークまたは安全な場所に保存

### ステップ6: 動作確認

1. コピーしたURLをブラウザで開く
2. タスク管理アプリのUIが表示されることを確認
3. テストタスクを1件入力：
   - タスク名: 「テストタスク」
   - 期限: 今日の日付
   - 詳細: 「動作確認用」
4. 「処理開始！」ボタンをクリック
5. 「処理が完了しました」というメッセージが表示されることを確認
6. [Google Calendar](https://calendar.google.com/)を開く
7. カレンダーID `9dsoil5r12um5nojs5qp1hun0g@group.calendar.google.com` に新しいイベントが作成されていることを確認
8. Google Driveで「Tsk タスク管理」フォルダが作成され、ドキュメントが含まれていることを確認

## 設定のカスタマイズ

### カレンダーIDの変更

デフォルトのカレンダーID（`9dsoil5r12um5nojs5qp1hun0g@group.calendar.google.com`）を変更する場合：

1. `Code.gs`を開く
2. `processTaskList()`関数内の以下の行を見つける：
```javascript
const calendarId = "9dsoil5r12um5nojs5qp1hun0g@group.calendar.google.com";
```
3. カレンダーIDを自分のカレンダーIDに変更
4. 保存して再デプロイ

### フォルダ名の変更

Google Docsファイルを保存するフォルダ名を変更する場合：

1. `Code.gs`を開く
2. `processTaskList()`関数内の以下の行を見つける：
```javascript
const folderName = "Tsk タスク管理";
```
3. フォルダ名を変更
4. 保存して再デプロイ

## 再デプロイ方法

コードを更新した後に再デプロイする場合：

1. コードを編集して保存
2. 「デプロイ」→「デプロイを管理」をクリック
3. 既存のデプロイの右側にある✏️（編集）アイコンをクリック
4. 「バージョン」を「新バージョン」に変更
5. 「デプロイ」ボタンをクリック
6. URLは変わらないため、既存のブックマークがそのまま使用できます

## トラブルシューティング

### エラー: "カレンダーへのアクセスに失敗しました"

**原因**: カレンダーIDが無効、または権限がない

**解決方法**:
1. カレンダーIDが正しいか確認
2. 該当カレンダーへのアクセス権限があるか確認
3. Calendar APIの権限が承認されているか確認

### エラー: "Docsファイルの作成に失敗しました"

**原因**: Drive APIまたはDocs APIの権限不足

**解決方法**:
1. GASプロジェクトの「プロジェクトの設定」を開く
2. 「Google Cloud Platform (GCP) プロジェクト」セクションで、APIが有効になっているか確認
3. 必要に応じて権限を再承認

### エラー: "このアプリは確認されていません"

**原因**: Googleによる確認を受けていない個人プロジェクト

**解決方法**:
1. 「詳細」をクリック
2. 「[プロジェクト名]（安全ではないページ）に移動」をクリック
3. これは自分で作成したスクリプトなので安全です

### UIが表示されない

**原因**: デプロイ設定が正しくない

**解決方法**:
1. デプロイ時に「ウェブアプリ」を選択したか確認
2. 「次のユーザーとして実行」が「自分」になっているか確認
3. URLが正しいか確認（`/exec`で終わる必要があります）

## セキュリティに関する注意事項

1. **アクセス制限**: 「アクセスできるユーザー」を適切に設定してください
   - 個人使用の場合: 「自分のみ」
   - チーム使用の場合: 組織内のユーザーのみ

2. **URLの管理**: デプロイURLは秘密情報として扱ってください
   - 公開リポジトリにコミットしない
   - 信頼できる人とのみ共有

3. **権限の最小化**: 必要な権限のみを承認してください

## 初期設定（オプション）

### タスク番号の初期化

タスク番号は自動的に1から開始されますが、手動で設定することもできます：

1. GASエディタで「実行」→「関数を実行」→「initializeTaskNumber」を選択
2. 以下のコードを`Code.gs`に追加：
```javascript
function initializeTaskNumber() {
  const properties = PropertiesService.getScriptProperties();
  properties.setProperty('taskNo', '1');
  Logger.log('タスク番号を1に初期化しました');
}
```
3. 関数を実行

## サポート

問題が解決しない場合は、以下を確認してください：
- GASのログ（「実行数」→「実行ログ」）
- ブラウザのコンソール（F12キーで開く）
- エラーメッセージの詳細

---

デプロイが完了したら、このガイドを保存しておくことをお勧めします。
